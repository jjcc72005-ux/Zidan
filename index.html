<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>🌍 خريطة العالم التفاعلية</title>

  <!-- مكتبة Three.js (الكرة الأرضية) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

  <!-- مكتبة Leaflet (الخريطة 2D) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: "Cairo", sans-serif;
      background: radial-gradient(ellipse at bottom, #020111 0%, #000000 100%);
      color: white;
    }
    #switch-btn {
      position: fixed;
      top: 15px;
      left: 15px;
      padding: 10px 18px;
      background: rgba(0,0,0,0.6);
      color: #00ffff;
      border: 1px solid #00ffff;
      border-radius: 8px;
      cursor: pointer;
      z-index: 10;
      font-weight: bold;
      transition: 0.3s;
    }
    #switch-btn:hover { background: rgba(0,255,255,0.2); }
    #globe, #map {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
    }
    #map { display: none; }
    #info-box {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: rgba(0,0,0,0.6);
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 14px;
      color: #b7f5ff;
      z-index: 10;
    }
  </style>
</head>
<body>
  <button id="switch-btn">🗺️ عرض الخريطة 2D</button>
  <div id="globe"></div>
  <div id="map"></div>
  <div id="info-box">اضغط على أي دولة لمعرفة اسمها</div>

  <script>
    // ========= إعداد المشهد 3D =========
    let scene, camera, renderer, globe, controls, stars;
    const container = document.getElementById("globe");

    function initGlobe() {
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
      camera.position.set(0, 0, 2.5);

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      container.appendChild(renderer.domElement);

      controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;

      // إضاءة
      const light = new THREE.DirectionalLight(0xffffff, 1);
      light.position.set(5, 3, 5);
      scene.add(light);
      scene.add(new THREE.AmbientLight(0x404040));

      // كرة الأرض
      const texLoader = new THREE.TextureLoader();
      const earthTexture = texLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/land_ocean_ice_cloud_2048.jpg');
      const sphereGeo = new THREE.SphereGeometry(1, 64, 64);
      const sphereMat = new THREE.MeshPhongMaterial({ map: earthTexture });
      globe = new THREE.Mesh(sphereGeo, sphereMat);
      scene.add(globe);

      // نجوم متحركة (المجرة)
      const starGeo = new THREE.SphereGeometry(90, 64, 64);
      const starMat = new THREE.MeshBasicMaterial({
        map: texLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/galaxy_starfield.png'),
        side: THREE.BackSide
      });
      stars = new THREE.Mesh(starGeo, starMat);
      scene.add(stars);

      animate();
    }

    function animate() {
      requestAnimationFrame(animate);
      globe.rotation.y += 0.0008;
      stars.rotation.y += 0.0002;
      controls.update();
      renderer.render(scene, camera);
    }

    // ========= الخريطة 2D =========
    const mapDiv = L.map('map', {
      center: [20, 0],
      zoom: 2,
      worldCopyJump: true,
      zoomControl: false,
    });

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 6,
      attribution: '&copy; OpenStreetMap',
    }).addTo(mapDiv);

    // رسم حدود الدول (GeoJSON عام)
    fetch("https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson")
      .then(r => r.json())
      .then(data => {
        L.geoJSON(data, {
          style: {
            color: "#00ffff",
            weight: 1,
            fillOpacity: 0.1
          },
          onEachFeature: function(feature, layer) {
            layer.on('click', function() {
              const name = feature.properties.ADMIN || "غير معروف";
              document.getElementById("info-box").textContent = `🌍 ${name}`;
            });
          }
        }).addTo(mapDiv);
      });

    // ========= التبديل بين الوضعين =========
    const switchBtn = document.getElementById("switch-btn");
    const mapEl = document.getElementById("map");

    let is3D = true;
    switchBtn.addEventListener("click", () => {
      if (is3D) {
        container.style.display = "none";
        mapEl.style.display = "block";
        switchBtn.textContent = "🌌 عرض الكرة الأرضية 3D";
      } else {
        container.style.display = "block";
        mapEl.style.display = "none";
        switchBtn.textContent = "🗺️ عرض الخريطة 2D";
      }
      is3D = !is3D;
    });

    // ========= بدء التشغيل =========
    initGlobe();
    window.addEventListener("resize", () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
      mapDiv.invalidateSize();
    });
  </script>
</body>
</html>
